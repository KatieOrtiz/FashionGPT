<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="static/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <title>Dashboard</title>
</head>
<body class="single-section-page">
  <header class="header">
    <div class="container">
      <nav class="navbar">
        <a href="/">
          <img src="https://cdn.glitch.global/70b98674-7945-4933-94d7-ed8029fb2905/logo.PNG?v=1714897729283" class="fashiongptlogo">
        </a>
        <div class="navbarh1">
          <h1>FashionGPT</h1>
        </div>
        <div class="navsearch">
          <input id="searchInput" type="text" placeholder="Search..." />
        </div>
        <div class="pagebuttons">
          <ul>
            <li></li>
            <span id="homebutton"><i class="fas fa-house"></i></span>
            <span id="likebutton"><i class="fas fa-heart"></i></span>
            <span id="settingbutton" class="dropdown"><i class="fas fa-gear"></i>
              <div class="dropdown-content">
                <a id="settingsdd">Settings</a>
                <a href="/logout">Signout</a>
                </div>
            </span>
          </ul>
        </div>
      </nav>
    </div>
  </header>
  <button id="generateoutfit" class="generateoutfit">Generate a new outfit!</button>
    <div class="container2">
      <h1 class="dashh1">Outfit Suggestions</h1>
    <div id="output-section"></div>
    {% for suggestion_id, products in suggestion_products.items() %}
    <div class="user-suggestion">
      <div class="suggestion-header">
        <h2 id ="dashh2">Outfit Suggestion #{{ loop.index }}</h2> 
        
        <!-- Button to mark suggestion as favorite -->
        <button class="mark-favorite" data-suggestion-id="{{ suggestion_id }}">
          {% if suggestion_id in favorite_suggestion_ids %}
              <i class="fas fa-heart"></i> <!-- Filled heart icon -->
          {% else %}
              <i class="far fa-heart"></i> <!-- Unfilled heart icon -->
          {% endif %}
      </button>
    </div>
    <div class="suggested-products">
      <br>
      <div class="clothing-item-tile">
        <!-- Display product image -->
        <div class="mt-6 grid gap-6 lg:grid-cols-2 xl:grid-cols-3">
          {% for product in products %}
          <div class="flex item-center rounded-lg bg-white shadow-lg overflow-hidden w-96">
              <img src="{{ product.image }}" alt="Product Image" class="bg-contain h-full w-32 flex-shrink-0">
              <div class="px-6 py-4">
                  {% if product %}
                      <h3 class="text-md font-semibold text-gray-800">{{ product.name }}</h3>
                      <p class="text-gray-600">Price: ${{ product.price }}</p>
                      <div class="mt-4">
                          <a  href="{{ product.link }}" target="_blank" class="text-indigo-500 hover:text-indigo-400 font-semibold text-sm">View Product</a>
                      </div>
                  {% else %}
                      <p>Product not available</p>
                  {% endif %}
              </div>
          </div>
      {% endfor %}
            </div>

        </div>
    </div>
   
</div>
    {% endfor %}
    <script src="static/script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Add event listener to all mark favorite buttons
        document.querySelectorAll('.mark-favorite').forEach(function(button) {
            // Check if suggestion is already favorited
            const suggestionId = button.dataset.suggestionId;
            fetch('/check-favorite?suggestion_id=' + suggestionId)
                .then(response => response.json())
                .then(data => {
                    if (data.isFavorite) {
                        button.innerHTML = '<i class="fas fa-heart"></i>'; // Filled heart icon
                    }
                });

            button.addEventListener('click', function() {
                // Get the suggestion ID from data attribute
                const suggestionId = button.dataset.suggestionId;
                
                // Toggle favorite status
                if (button.classList.contains('favorited')) {
                    // Remove from favorites
                    fetch('/remove-favorite', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ suggestion_id: suggestionId })
                    })
                    .then(response => {
                        if (response.ok) {
                            button.innerHTML = '<i class="far fa-heart"></i>'; // Unfilled heart icon
                            button.classList.remove('favorited');
                        } else {
                            alert('Failed to remove suggestion from favorites.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Failed to remove suggestion from favorites.');
                    });
                } else {
                    // Add to favorites
                    fetch('/mark-favorite', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ suggestion_id: suggestionId })
                    })
                    .then(response => {
                        if (response.ok) {
                            button.innerHTML = '<i class="fas fa-heart"></i>'; // Filled heart icon
                            button.classList.add('favorited');
                        } else {
                            alert('Failed to mark suggestion as favorite.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Failed to mark suggestion as favorite.');
                    });
                }
            });
        });
    });
      // Script to fetch and display data from the server
      document
        .getElementById("submit-filters")
        .addEventListener("click", function (event) {
          event.preventDefault(); // Prevent default form submission
          var formData = new FormData(document.getElementById("filters-form"));

          fetch("/pref", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              const outputDiv = document.getElementById("output-section");
              outputDiv.innerHTML = ""; // Clear previous content
              // Dynamically create content based on data received
              data.forEach((choice, index) => {
                let choiceDiv = document.createElement("div");
                choiceDiv.innerHTML = `<h3>Choice ${index + 1}</h3>`;
                Object.keys(choice).forEach((key) => {
                  let itemDiv = document.createElement("div");
                  itemDiv.textContent = `${key}: ${choice[key].join(" - ")}`;
                  choiceDiv.appendChild(itemDiv);
                });
                outputDiv.appendChild(choiceDiv);
              });
            })
            .catch((error) => console.error("Error:", error));
        });
    </script>

  </body>

</html>